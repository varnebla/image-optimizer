---
import Layout from '@layouts/Layout.astro';
import InfoSection from '@components/InfoSection.astro';
import ImageDrop from '@components/ImageDrop.vue';
import ValidationWarnings from '@components/ValidationWarnings.vue';
import ImagePreview from '@components/ImagePreview.vue';
import PresetsSelector from '@components/PresetsSelector.vue';
import SettingsPanel from '@components/SettingsPanel.vue';

import ProgressList from '@components/ProgressList.vue';
import ResultSummary from '@components/ResultSummary.vue';
import DetailedStats from '@components/DetailedStats.vue';
import OptimizeButton from '@components/OptimizeButton.vue';
import SessionLog from '@components/SessionLog.vue';
import FAQSection from '@components/FAQSection.astro';
import { getLangFromUrl, useTranslations } from '@i18n/utils';
import type { Lang } from '@i18n/ui';
import PageTitle from '@components/PageTitle.astro';

const lang = getLangFromUrl(Astro.url) as Lang;
const t = useTranslations(lang);

// hreflang pair
const hrefEn = 'https://image-optimizer.xyz/en';
const hrefEs = 'https://image-optimizer.xyz';
const canonical = hrefEn;
---

<Layout
  title={t('page.home.title')}
  description={t('page.home.description')}
  hrefEn={hrefEn}
  hrefEs={hrefEs}
  canonical={canonical}
>
  <div id="app" class="max-w-6xl mx-auto p-8">
    <PageTitle>{t('page.home.heading')}</PageTitle>
    <ImageDrop client:load lang={lang} />
    <ValidationWarnings client:idle lang={lang} />
    <ImagePreview client:idle lang={lang} />
    <PresetsSelector client:load lang={lang} />
    <SettingsPanel client:load lang={lang} />
    <OptimizeButton client:load lang={lang} />
    <ProgressList client:only="vue" lang={lang} />
    <ResultSummary client:only="vue" lang={lang} />
    <SessionLog client:visible lang={lang} />
    <DetailedStats client:only="vue" lang={lang} />
    <InfoSection />
    <FAQSection />
  </div>
</Layout>

<script is:inline>
  // Previene que el navegador abra la imagen en una pestaÃ±a nueva si el drop no ocurre en el drop-zone
  window.addEventListener('drop', (e) => {
    const dropZone = document.getElementById('drop-zone');
    if (!dropZone || !dropZone.contains(e.target)) {
      e.preventDefault();
    }
  });
  window.addEventListener('dragover', (e) => {
    const dropZone = document.getElementById('drop-zone');
    if (!dropZone || !dropZone.contains(e.target)) {
      e.preventDefault();
    }
  });
</script>
