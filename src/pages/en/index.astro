---
import Layout from '@layouts/Layout.astro';
import InfoSection from '@components/InfoSection.astro';
import ImageDrop from '@components/ImageDrop.vue';
import ValidationWarnings from '@components/ValidationWarnings.vue';
import PresetsSelector from '@components/PresetsSelector.vue';
import SettingsPanel from '@components/SettingsPanel.vue';

import ProgressList from '@components/ProgressList.vue';
import ResultSummary from '@components/ResultSummary.vue';
import OptimizeButton from '@components/OptimizeButton.vue';
import FAQSection from '@components/FAQSection.astro';
import { getLangFromUrl, useTranslations } from '@i18n/utils';
import type { Lang } from '@i18n/ui';
import PageTitle from '@components/PageTitle.astro';

const lang = getLangFromUrl(Astro.url) as Lang;
const t = useTranslations(lang);

// hreflang pair
const hrefEn = 'https://image-optimizer.xyz/en';
const hrefEs = 'https://image-optimizer.xyz';
const canonical = hrefEn;
---

<Layout
  title={t('page.home.title')}
  description={t('page.home.description')}
  hrefEn={hrefEn}
  hrefEs={hrefEs}
  canonical={canonical}
>
  <div id="app" class="max-w-4xl mx-auto px-8 pt-12 lg:px-0">
    <PageTitle>{t('page.home.heading')}</PageTitle>

    <!-- Zona de drop principal -->
    <ImageDrop client:load lang={lang} />

    <!-- Advertencias de validaci칩n (si las hay) -->
    <ValidationWarnings client:idle lang={lang} />

    <!-- Panel de ajustes colapsable -->
    <SettingsPanel client:load lang={lang} />

    <!-- Botones de ajustes y re-optimizaci칩n -->
    <OptimizeButton client:load lang={lang} />

    <!-- Resultado (solo visible cuando hay resultados) -->
    <ResultSummary client:only="vue" lang={lang} />

    <!-- Lista de progreso con thumbnails -->
    <ProgressList client:only="vue" lang={lang} />

    <!-- Informaci칩n y FAQ -->
    <InfoSection />
    <FAQSection />
  </div>
</Layout>

<script is:inline>
  // Previene que el navegador abra la imagen en una pesta침a nueva si el drop no ocurre en el drop-zone
  window.addEventListener('drop', (e) => {
    const dropZone = document.getElementById('drop-zone');
    if (!dropZone || !dropZone.contains(e.target)) {
      e.preventDefault();
    }
  });
  window.addEventListener('dragover', (e) => {
    const dropZone = document.getElementById('drop-zone');
    if (!dropZone || !dropZone.contains(e.target)) {
      e.preventDefault();
    }
  });
</script>
